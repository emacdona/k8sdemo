\documentclass{beamer}

\usepackage[utf8]{inputenc}
\usepackage{minted}
\usepackage{listings}
\usepackage{graphicx}

%\usetheme{Warsaw}
\usetheme{metropolis}
\usecolortheme{beaver}

\title[Kubernetes]{Introduction to Kubernetes}
\author{Ed MacDonald}
\institute{Solution Street}
\date{June 2020}

\begin{document}
\frame{\titlepage}

\begin{frame}
\frametitle{What is Kubernetes?}
A Declarative Container Orchestration Framework
\end{frame}

\begin{frame}
\frametitle{Declarative}
Most Kubernetes API calls involve either:
\begin{itemize}
    \item You telling Kubernetes what you want the state of a given set of objects to converge to, or
    \item You asking Kubernetes what the current state of a given set of objects is
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{Kubernetes API}
Think of the Kubernetes API as a way to:
\begin{itemize}
    \item Send YAML documents to Kubernetes which specify components you would like to create in your cluster.
    \item Send REST requests to Kubernetes that specify updates to the desired state you would like components in your cluster to converge to.
    \item Sent REST requests asking Kubernetes for the current state of components in your cluster.
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{kubectl}
\begin{itemize}
\item kubectl is a command line tool used to communicate with Kubernetes clusters.
\item It provides a convenient way to do all the things mentioned on the previous slide.
\item We will be using it to update components in our cluster and view their state
\item You \textbf{\textit{can}} use it to create components, but there is a better way to do that...
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{helm}
\begin{itemize}
    \item helm is a tool for packaging and deploying Kubernetes apps.
    \item For our purposes, just think of as a way to package all the YAML files that create the components that make your app, and then deploy them to a cluster.
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{Kubernetes Nodes}
\begin{itemize}
\item Kubernetes Nodes are compute instances (e.g.: virtual machines, bare metal servers) running the Kubernetes software components that allow them to communicate and cooperate with each other to run your application(s)
\item Kubernetes schedules Pods to run on the nodes that make up the cluster.
\end{itemize}
\end{frame}

% https://www.patrickbaylis.com/posts/2018-10-11-beamer-resizing/
\begin{frame}
    \frametitle{Kubernetes Nodes}
    \includegraphics[width=\textwidth,height=\textheight,keepaspectratio]{graphics/00-nodes.eps}
\end{frame}

\begin{frame}
\begin{center}
\Huge Kubernetes Components
\end{center}
\end{frame}

\begin{frame}
\frametitle{Pods.}
Pods (not containers!) are the fundamental building blocks of a Kubernetes application
\begin{itemize}
    \item A Pod is a group of one or more containers that work closely together on a specific task.
    \item Containers in a Pod can share the same volume mounts.
    \item Some Containers in a Pod can be Init Containers. They run before other pods start and are used to perform initialization tasks. The can communicate with other pods through the aforementioned shared volumes.
\end{itemize}
\end{frame}

\begin{frame}
    \frametitle{System Pods}
    \includegraphics[width=\textwidth,height=\textheight,keepaspectratio]{graphics/01-systemPods.eps}
\end{frame}

\begin{frame}
    \frametitle{Stateless Application Pods}
    \includegraphics[width=\textwidth,height=\textheight,keepaspectratio]{graphics/02-statelessAppPods.eps}
\end{frame}

\begin{frame}
\frametitle{ReplicaSets}
\begin{itemize}    
    \item ReplicaSets allow you to declare to Kubernetes how many of a given type of Pod you wish to have running.
    \item Pods in a ReplicaSet are treated as if they are Stateless.
\end{itemize}
\end{frame}

\begin{frame}
    \frametitle{Deployments}
    \begin{itemize}
        \item Deployments are an even higher level abstraction than Replica Sets.
        \item The docs say they provide "declarative updates to Pods".
        \item I'll use them in my example instead of Replica Sets, but we won't use any of their additional features.
    \end{itemize}
\end{frame}

\begin{frame}
    \frametitle{Deployment}
    \includegraphics[width=\textwidth,height=\textheight,keepaspectratio]{graphics/03-deployment.eps}
\end{frame}

\begin{frame}
    \frametitle{Stateful Application Pods}
    \includegraphics[width=\textwidth,height=\textheight,keepaspectratio]{graphics/04-statefulAppPods.eps}
\end{frame}

\begin{frame}
    \frametitle{Statefulset}
    \includegraphics[width=\textwidth,height=\textheight,keepaspectratio]{graphics/05-statefulSet.eps}
\end{frame}

\begin{frame}
    \frametitle{Persistent Storage}
    \includegraphics[width=\textwidth,height=\textheight,keepaspectratio]{graphics/06-persistence.eps}
\end{frame}

\begin{frame}
    \frametitle{Headless Service}
    \includegraphics[width=\textwidth,height=\textheight,keepaspectratio]{graphics/07-persistentIdentity.eps}
\end{frame}

\begin{frame}
    \frametitle{Load Balancing Services}
    \includegraphics[width=\textwidth,height=\textheight,keepaspectratio]{graphics/08-loadBalancer.eps}
\end{frame}

\begin{frame}
\frametitle{Tools used}
\begin{itemize}
    \item Minikube (https://kubernetes.io/docs/tasks/tools/install-minikube/)
(will also have you install a hypervisor (eg: VirtualBox) and kubectl)
    \item Helm (https://helm.sh/docs/intro/install/)
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{Other Resources}
\begin{itemize}
    \item http://files.pushshift.io/reddit/subreddits/
\end{itemize}
\end{frame}

%\begin{frame}
%\frametitle{What’s Still To Do?}
%\begin{block}{Answered Questions}
%    How many primes are there?
%\end{block}
%\begin{block}{Open Questions}
%    Is every even number the sum of two primes?
%\end{block}
%\end{frame}
%
%\begin{frame}
%\frametitle{What’s Still To Do?}
%\begin{columns}
%    \column{.25\textwidth}
%    \begin{block}{Answered Questions}
%        How many primes are there?
%    \end{block}
%    \column{.75\textwidth}
%    \begin{block}{Open Questions}
%        Is every even number the sum of two primes?
%    \end{block}
%\end{columns}
%\end{frame}
%
%\begin{frame}[fragile]
%\frametitle{An Algorithm For Finding Prime Numbers.}
%\begin{minted}{cpp}
%int main (void)
%{
%    std::vector<bool> is_prime (100, true);
%    for (int i = 2; i < 100; i++)
%        if (is_prime[i])
%        {
%            std::cout << i << " ";
%            for (int j = i; j < 100; is_prime [j] = false, j+=i);
%        }
%    return 0;
%}
%\end{minted}
%\end{frame}
%
%\begin{frame}[fragile]
%\frametitle{Yaml?}
%\begin{columns}
%    \column{.25\textwidth}
%    \begin{block}{Answered Questions}
%        How many primes are there?
%    \end{block}
%    \column{.75\textwidth}
%    \begin{block}{Open Questions}
%\begin{minted}[style=friendly,fontsize=\fontsize{3}{4}]{yaml}
%---
%apiVersion: v1
%kind: Pod
%metadata:
%  namespace: default
%  name: demo-demo-6f95ccf6d5-pdnmc
%  labels:
%    app.kubernetes.io/instance: demo
%    app.kubernetes.io/name: demo
%spec:
%  containers:
%  - image: nginx:1.16.0
%    name: demo
%    livenessProbe:
%      httpGet:
%        path: /
%        port: http
%        scheme: HTTP
%    ports:
%    - containerPort: 80
%      name: http
%      protocol: TCP
%    readinessProbe:
%      httpGet:
%        path: /
%        port: http
%        scheme: HTTP
%    volumeMounts:
%    - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
%      name: demo-demo-token-dj7lr
%      readOnly: true
%  volumes:
%  - name: demo-demo-token-dj7lr
%    secret:
%      defaultMode: 420
%      secretName: demo-demo-token-dj7lr
%
%\end{minted}
%    \end{block}
%\end{columns}
%\end{frame}

\end{document}
